<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Teletext Pages</title>
    <link rel="stylesheet" href="../css/stylesheet.css">
    <script>
        let pageContent = [];

        async function loadPage() {
            const pageNum = document.getElementById('pageNum').value;
            const response = await fetch('../json/pages.json');
            const pages = await response.json();
            pageContent = pages[pageNum] || Array(24).fill().map(() => Array(40).fill({ type: 'char', value: ' ' }));
            renderPage(pageContent);
        }

        function renderPage(pageContent) {
            const pageGrid = document.getElementById('pageGrid');
            pageGrid.innerHTML = '';
            pageContent.forEach((row, rowIndex) => {
                row.forEach((cell, colIndex) => {
                    const sixel = document.createElement('div');
                    sixel.className = 'sixel';
                    if (cell.type === 'char') {
                        sixel.innerText = cell.value;
                        sixel.contentEditable = true;
                        sixel.oninput = () => {
                            pageContent[rowIndex][colIndex].value = sixel.innerText;
                        };
                    } else {
                        sixel.style.backgroundColor = cell.value;
                        sixel.onclick = () => {
                            const newColor = prompt("Enter color (white, black, yellow, cyan, magenta, dark blue, red, green):", cell.value);
                            sixel.style.backgroundColor = newColor;
                            pageContent[rowIndex][colIndex].value = newColor;
                        };
                    }
                    pageGrid.appendChild(sixel);
                });
            });
        }

        function copyToClipboard() {
            const pageNum = document.getElementById('pageNum').value;
            const pageData = JSON.stringify({ [pageNum]: pageContent }, null, 2);
            navigator.clipboard.writeText(pageData).then(() => {
                alert("Page copied to clipboard!");
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }
    </script>
</head>
<body>
    <div class="header">
        <input type="text" id="pageNum" maxlength="3" placeholder="Page #" oninput="loadPage()">
    </div>
    <div id="pageGrid" class="page-grid"></div>
    <button onclick="copyToClipboard()">Copy Page to Clipboard</button>
</body>
</html>